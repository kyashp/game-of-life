<!DOCTYPE html>
<html>
<head>
    <title>GOL Classes Test Suite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .test-section { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #ccc; 
            background: white;
            border-radius: 5px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        h1 { color: #333; text-align: center; }
        h3 { margin-top: 0; color: #444; }
        .details { margin-left: 20px; font-family: monospace; font-size: 12px; }
        .progress { background: #e0e0e0; height: 20px; border-radius: 10px; margin: 10px 0; }
        .progress-bar { height: 100%; background: #4CAF50; border-radius: 10px; transition: width 0.3s; }
        .nav-section { margin: 20px 0; text-align: center; }
        .nav-button { 
            display: inline-block; 
            margin: 5px; 
            padding: 10px 15px; 
            background: #007bff; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px;
            font-weight: bold;
        }
        .nav-button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üéÆ Game of Life Classes Test Suite</h1>
    
    <div class="nav-section">
        <h3>Choose Test Type:</h3>
        <a href="#" onclick="runAllTests()" class="nav-button">Run All Tests</a>
        <a href="test-individual.html" class="nav-button">Individual Class Tests</a>
        <a href="#" onclick="runQuickTest()" class="nav-button">Quick Test</a>
    </div>
    
    <div class="progress">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
    </div>
    
    <div id="summary" style="text-align: center; margin: 20px 0;">
        <span id="testCount">0</span> tests completed
    </div>
    
    <div id="results"></div>
    
    <!-- Load individual class files -->
    <script src="../GameOfLife-Classes/helper.js"></script>
    <script src="../GameOfLife-Classes/Authentication.js"></script>
    <script src="../GameOfLife-Classes/UserAccount.js"></script>
    <script src="../GameOfLife-Classes/DataSourceConnector.js"></script>
    <script src="../GameOfLife-Classes/InflationAdjuster.js"></script>
    <script src="../GameOfLife-Classes/TaxCalculator.js"></script>
    <script src="../GameOfLife-Classes/ParentProfile.js"></script>
    <script src="../GameOfLife-Classes/GovernmentBenefits.js"></script>
    <script src="../GameOfLife-Classes/CostEvent.js"></script>
    <script src="../GameOfLife-Classes/SimulationSession.js"></script>
    <script src="../GameOfLife-Classes/SimulationResult.js"></script>
    <script src="../GameOfLife-Classes/InsightsRequest.js"></script>
    <script src="../GameOfLife-Classes/corsUsage.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');
        const progressBar = document.getElementById('progressBar');
        const testCount = document.getElementById('testCount');
        
        let totalTests = 0;
        let completedTests = 0;
        let passedTests = 0;
        let failedTests = 0;

        function updateProgress() {
            completedTests++;
            const percentage = (completedTests / totalTests) * 100;
            progressBar.style.width = percentage + '%';
            testCount.textContent = `${completedTests}/${totalTests}`;
        }

        function logResult(testName, success, message, details = null) {
            const div = document.createElement('div');
            div.className = 'test-section';
            
            let detailsHTML = '';
            if (details) {
                detailsHTML = `<div class="details">${JSON.stringify(details, null, 2)}</div>`;
            }
            
            div.innerHTML = `
                <h3>${success ? '‚úÖ' : '‚ùå'} ${testName}</h3>
                <p class="${success ? 'success' : 'error'}">${message}</p>
                ${detailsHTML}
            `;
            resultsDiv.appendChild(div);
            
            console.log(`${testName}: ${success ? '‚úÖ' : '‚ùå'} ${message}`);
            if (details) console.log('Details:', details);
            
            if (success) passedTests++; else failedTests++;
            updateProgress();
        }

        function logInfo(message) {
            console.log(`‚ÑπÔ∏è ${message}`);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
            completedTests = 0;
            passedTests = 0;
            failedTests = 0;
            progressBar.style.width = '0%';
            testCount.textContent = '0';
        }

        async function runAllTests() {
            clearResults();
            totalTests = 17; // Update based on actual test count
            
            console.log('üöÄ Starting comprehensive GOL Classes test suite...');
            
            try {
                // Test 1: Class Availability
                logInfo('Testing class availability...');
                
                const classChecks = [
                    ['Authentication', typeof Authentication !== 'undefined'],
                    ['UserAccount', typeof UserAccount !== 'undefined'],
                    ['ParentProfile', typeof ParentProfile !== 'undefined'],
                    ['TaxCalculator', typeof TaxCalculator2025 !== 'undefined'],
                    ['InflationAdjuster', typeof InflationAdjuster !== 'undefined'],
                    ['DataSourceConnector', typeof DataSourceConnector !== 'undefined'],
                    ['SimulationSession', typeof SimulationSession !== 'undefined'],
                    ['GovernmentBenefits', typeof GovernmentBenefits !== 'undefined'],
                    ['CostEvent', typeof CostEvent !== 'undefined']
                ];
                
                classChecks.forEach(([className, exists]) => {
                    logResult(
                        `Class Check: ${className}`, 
                        exists, 
                        exists ? `${className} loaded successfully` : `${className} not found`
                    );
                });

                // Test 2: Helper Functions
                logInfo('Testing helper functions...');
                try {
                    const uniqueId = generateUniqueId('test');
                    const validId = typeof uniqueId === 'string' && uniqueId.startsWith('test_');
                    logResult(
                        'Helper Functions', 
                        validId, 
                        validId ? `Generated unique ID: ${uniqueId}` : 'Helper function failed',
                        { generatedId: uniqueId }
                    );
                } catch (error) {
                    logResult('Helper Functions', false, `Helper error: ${error.message}`);
                }

                // Test 3: Authentication Class
                logInfo('Testing Authentication class...');
                try {
                    const auth = new Authentication('auth_123', 'token_abc', new Date(Date.now() + 3600000));
                    const password = 'testPassword123';
                    const hashedPassword = auth.hashPassword(password);
                    const hashValid = typeof hashedPassword === 'string' && hashedPassword !== password;
                    
                    logResult(
                        'Authentication - Password Hashing', 
                        hashValid, 
                        hashValid ? 'Password hashed successfully' : 'Password hashing failed',
                        { 
                            originalLength: password.length, 
                            hashedLength: hashedPassword.length,
                            authId: auth.authId
                        }
                    );
                } catch (error) {
                    logResult('Authentication - Password Hashing', false, `Auth error: ${error.message}`);
                }

                // Test 4: User Account Creation and Login
                logInfo('Testing user account creation and login...');
                try {
                    const tempUserId = generateUniqueId('user');
                    const testUsername = 'testuser' + Date.now();
                    const testEmail = `test${Date.now()}@example.com`;
                    
                    const user = new UserAccount(tempUserId, testUsername, testEmail);
                    const signupResult = user.signup(testUsername, testEmail, 'password123');
                    
                    logResult(
                        'User Account Signup', 
                        signupResult, 
                        signupResult ? `User created with ID: ${user.userId}` : 'Signup failed',
                        { 
                            userId: user.userId, 
                            username: user.username, 
                            email: user.email
                        }
                    );

                    if (signupResult) {
                        const loginResult = user.login('password123');
                        logResult(
                            'User Account Login', 
                            loginResult, 
                            loginResult ? 'Login successful' : 'Login failed'
                        );
                    }
                } catch (error) {
                    logResult('User Account Creation', false, `User account error: ${error.message}`);
                }

                // Test 5: Data Source Connector
                logInfo('Testing data source connector...');
                try {
                    const dataConnector = new DataSourceConnector('ECDA_CHILDCARE');
                    const childcareData = await dataConnector.fetchData();
                    const dataLoaded = childcareData && childcareData.result && childcareData.result.records.length > 0;
                    
                    logResult(
                        'Data Source Connection', 
                        dataLoaded, 
                        dataLoaded ? `Loaded ${childcareData.result.records.length} childcare centres` : 'Data loading failed',
                        {
                            sourceType: dataConnector.sourceType,
                            recordCount: childcareData?.result?.records?.length,
                            sampleRecord: childcareData?.result?.records?.[0]
                        }
                    );
                } catch (error) {
                    logResult('Data Source Connection', false, `Data connection error: ${error.message}`);
                }

                // Test 6: Tax Calculator
                logInfo('Testing tax calculator...');
                try {
                    const taxCalc = new TaxCalculator2025();
                    const testIncome = 60000; // Annual income
                    const taxAmount = taxCalc.calculateIncomeTax(testIncome, 'CITIZEN');
                    const taxCalculated = typeof taxAmount === 'number' && taxAmount >= 0;
                    
                    logResult(
                        'Tax Calculation', 
                        taxCalculated, 
                        taxCalculated ? `Tax calculated: $${taxAmount.toFixed(2)} for $${testIncome} income` : 'Tax calculation failed',
                        {
                            annualIncome: testIncome,
                            taxAmount: taxAmount,
                            effectiveRate: ((taxAmount / testIncome) * 100).toFixed(2) + '%'
                        }
                    );
                } catch (error) {
                    logResult('Tax Calculation', false, `Tax calculation error: ${error.message}`);
                }

                // Test 7: Inflation Adjuster
                logInfo('Testing inflation adjuster...');
                try {
                    const inflationAdjuster = new InflationAdjuster();
                    await inflationAdjuster.initialize();
                    
                    const futureCost = inflationAdjuster.adjustCostForFutureInflation(1000, 18);
                    const inflationWorks = futureCost > 1000;
                    
                    logResult(
                        'Inflation Adjustment', 
                        inflationWorks, 
                        inflationWorks ? `$1000 today = $${futureCost.toFixed(2)} in 18 years` : 'Inflation calculation failed',
                        {
                            originalCost: 1000,
                            adjustedCost: futureCost,
                            yearsAhead: 18
                        }
                    );
                } catch (error) {
                    logResult('Inflation Adjustment', false, `Inflation error: ${error.message}`);
                }

                // Test 8: Government Benefits
                logInfo('Testing government benefits...');
                try {
                    const benefit = new GovernmentBenefits(
                        'test_benefit',
                        'childcare_subsidy',
                        'Monthly childcare subsidy',
                        'citizenship,income',
                        'income_father * 0.1',
                        ['PRESCHOOL']
                    );
                    
                    // Create a mock profile for testing
                    const mockProfile = {
                        residencyStatusFather: 'CITIZEN',
                        grossMthlyIncomeFather: 5000,
                        grossMthlyIncomeMother: 3000
                    };
                    
                    const eligible = benefit.calculateEligibility(mockProfile);
                    const benefitValue = benefit.calculateValue(mockProfile);
                    
                    logResult(
                        'Government Benefits', 
                        typeof benefitValue === 'number', 
                        `Benefit calculated: $${benefitValue}/month, Eligible: ${eligible}`,
                        {
                            benefitName: benefit.name,
                            eligible: eligible,
                            monthlyValue: benefitValue
                        }
                    );
                } catch (error) {
                    logResult('Government Benefits', false, `Benefits error: ${error.message}`);
                }

                // Final Summary
                setTimeout(() => {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.className = 'test-section';
                    summaryDiv.style.backgroundColor = passedTests > failedTests ? '#d4edda' : '#f8d7da';
                    summaryDiv.innerHTML = `
                        <h2>üìä Test Summary</h2>
                        <p><strong>Total Tests:</strong> ${totalTests}</p>
                        <p class="success"><strong>Passed:</strong> ${passedTests}</p>
                        <p class="error"><strong>Failed:</strong> ${failedTests}</p>
                        <p><strong>Success Rate:</strong> ${((passedTests/totalTests)*100).toFixed(1)}%</p>
                        <p class="info">All individual class files loaded and tested successfully!</p>
                    `;
                    resultsDiv.appendChild(summaryDiv);
                }, 1000);

            } catch (error) {
                logResult('Critical Error', false, error.message);
                console.error('Critical test error:', error);
            }
        }

        async function runQuickTest() {
            clearResults();
            totalTests = 5;
            
            console.log('üöÄ Running quick test...');
            
            try {
                // Quick class availability check
                const criticalClasses = [
                    ['UserAccount', typeof UserAccount !== 'undefined'],
                    ['ParentProfile', typeof ParentProfile !== 'undefined'],
                    ['TaxCalculator', typeof TaxCalculator2025 !== 'undefined'],
                    ['DataSourceConnector', typeof DataSourceConnector !== 'undefined'],
                    ['SimulationSession', typeof SimulationSession !== 'undefined']
                ];
                
                criticalClasses.forEach(([className, exists]) => {
                    logResult(
                        `Quick Check: ${className}`, 
                        exists, 
                        exists ? `${className} available` : `${className} missing`
                    );
                });

                // Summary
                setTimeout(() => {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.className = 'test-section';
                    summaryDiv.style.backgroundColor = passedTests === totalTests ? '#d4edda' : '#f8d7da';
                    summaryDiv.innerHTML = `
                        <h2>‚ö° Quick Test Results</h2>
                        <p><strong>All Critical Classes:</strong> ${passedTests === totalTests ? 'Available ‚úÖ' : 'Missing Some ‚ùå'}</p>
                        <p><strong>Ready for Full Testing:</strong> ${passedTests === totalTests ? 'Yes' : 'No - Fix missing classes first'}</p>
                    `;
                    resultsDiv.appendChild(summaryDiv);
                }, 500);

            } catch (error) {
                logResult('Quick Test Error', false, error.message);
            }
        }

        // Auto-run quick test on page load
        window.addEventListener('load', runQuickTest);
    </script>
</body>
</html>