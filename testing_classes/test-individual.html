<!DOCTYPE html>
<html>
<head>
    <title>Individual Class Tests - GOL</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .test-class { 
            margin: 20px 0; 
            padding: 15px; 
            border: 2px solid #ddd; 
            background: white;
            border-radius: 10px;
        }
        .test-method { 
            margin: 10px 0; 
            padding: 10px; 
            border-left: 4px solid #007bff; 
            background: #f8f9fa;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .test-button { 
            padding: 8px 15px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
        }
        .test-button:hover { background: #0056b3; }
        .nav-back { 
            display: inline-block; 
            margin-bottom: 20px; 
            padding: 10px 15px; 
            background: #6c757d; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px;
        }
        .details { 
            font-family: monospace; 
            font-size: 12px; 
            background: #f1f1f1; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <a href="test.html" class="nav-back">← Back to Main Tests</a>
    
    <h1> Individual Class Testing</h1>
    
    <div id="testContainer"></div>

    <!-- Load individual class files -->
    <script src="../GameOfLife-Classes/helper.js"></script>
    <script src="../GameOfLife-Classes/Authentication.js"></script>
    <script src="../GameOfLife-Classes/UserAccount.js"></script>
    <script src="../GameOfLife-Classes/DataSourceConnector.js"></script>
    <script src="../GameOfLife-Classes/InflationAdjuster.js"></script>
    <script src="../GameOfLife-Classes/TaxCalculator.js"></script>
    <script src="../GameOfLife-Classes/ParentProfile.js"></script>
    <script src="../GameOfLife-Classes/GovernmentBenefits.js"></script>
    <script src="../GameOfLife-Classes/CostEvent.js"></script>
    <script src="../GameOfLife-Classes/SimulationSession.js"></script>
    <script src="../GameOfLife-Classes/SimulationResult.js"></script>
    <script src="../GameOfLife-Classes/InsightsRequest.js"></script>

    <script>
        const testContainer = document.getElementById('testContainer');

        function createTestSection(className, methods) {
            const section = document.createElement('div');
            section.className = 'test-class';
            
            let methodsHTML = '';
            methods.forEach(method => {
                methodsHTML += `
                    <div class="test-method">
                        <strong>${method.name}</strong>: ${method.description}
                        <br>
                        <button class="test-button" onclick="${method.testFunction}">Test ${method.name}</button>
                        <div id="${method.resultId}"></div>
                    </div>
                `;
            });

            section.innerHTML = `
                <h2> ${className} Tests</h2>
                <button class="test-button" onclick="testAll${className}()" style="background: #28a745;">Test All ${className} Methods</button>
                ${methodsHTML}
            `;
            
            testContainer.appendChild(section);
        }

        function logMethodResult(resultId, success, message, details = null) {
            const resultDiv = document.getElementById(resultId);
            let detailsHTML = '';
            if (details) {
                detailsHTML = `<div class="details">${JSON.stringify(details, null, 2)}</div>`;
            }
            
            resultDiv.innerHTML = `
                <p class="${success ? 'success' : 'error'}">
                    ${success ? '✅' : '❌'} ${message}
                </p>
                ${detailsHTML}
            `;
        }

        // Authentication Tests
        function testAuthHashPassword() {
            try {
                const auth = new Authentication('auth_123', 'token_abc', new Date());
                const password = 'testPassword123';
                const hashed = auth.hashPassword(password);
                const success = typeof hashed === 'string' && hashed !== password;
                
                logMethodResult('auth-hash-result', success, 
                    success ? 'Password hashed successfully' : 'Password hashing failed',
                    { original: password, hashed: hashed.substring(0, 20) + '...' }
                );
            } catch (error) {
                logMethodResult('auth-hash-result', false, `Error: ${error.message}`);
            }
        }

        function testAuthVerifyCredentials() {
            try {
                const auth = new Authentication('auth_123', 'token_abc', new Date());
                // This requires a user to be in localStorage, so we'll create one first
                const testUser = {
                    username: 'testuser',
                    password: auth.hashPassword('testpass123')
                };
                localStorage.setItem('user_testuser', JSON.stringify(testUser));
                
                const result = auth.verifyCredentials('testuser', 'testpass123');
                logMethodResult('auth-verify-result', result, 
                    result ? 'Credentials verified successfully' : 'Credential verification failed'
                );
            } catch (error) {
                logMethodResult('auth-verify-result', false, `Error: ${error.message}`);
            }
        }

        function testAllAuthentication() {
            testAuthHashPassword();
            setTimeout(testAuthVerifyCredentials, 100);
        }

        // UserAccount Tests
        function testUserSignup() {
            try {
                const userId = generateUniqueId('user');
                const username = 'testuser' + Date.now();
                const email = `test${Date.now()}@example.com`;
                
                const user = new UserAccount(userId, username, email);
                const result = user.signup(username, email, 'password123');
                
                logMethodResult('user-signup-result', result,
                    result ? `User ${username} created successfully` : 'User signup failed',
                    { userId: user.userId, username: user.username }
                );
            } catch (error) {
                logMethodResult('user-signup-result', false, `Error: ${error.message}`);
            }
        }

        function testUserLogin() {
            try {
                // First create a user
                const userId = generateUniqueId('user');
                const username = 'logintest' + Date.now();
                const email = `login${Date.now()}@example.com`;
                
                const user = new UserAccount(userId, username, email);
                const signupResult = user.signup(username, email, 'password123');
                
                if (signupResult) {
                    const loginResult = user.login('password123');
                    logMethodResult('user-login-result', loginResult,
                        loginResult ? 'User login successful' : 'User login failed'
                    );
                } else {
                    logMethodResult('user-login-result', false, 'Cannot test login - signup failed');
                }
            } catch (error) {
                logMethodResult('user-login-result', false, `Error: ${error.message}`);
            }
        }

        function testAllUserAccount() {
            testUserSignup();
            setTimeout(testUserLogin, 200);
        }

        // TaxCalculator Tests
        function testTaxCalculation() {
            try {
                const taxCalc = new TaxCalculator2025();
                const income = 60000;
                const result = taxCalc.calculateIncomeTax(income, 'CITIZEN');
                const success = typeof result === 'number' && result >= 0;
                
                logMethodResult('tax-calc-result', success,
                    success ? `Tax calculated: $${result.toFixed(2)} for $${income} income` : 'Tax calculation failed',
                    {
                        income: income,
                        taxAmount: result,
                        effectiveRate: ((result / income) * 100).toFixed(2) + '%'
                    }
                );
            } catch (error) {
                logMethodResult('tax-calc-result', false, `Error: ${error.message}`);
            }
        }

        function testAllTaxCalculator() {
            testTaxCalculation();
        }

        // DataSourceConnector Tests
        async function testDataConnection() {
            try {
                const connector = new DataSourceConnector('ECDA_CHILDCARE');
                const data = await connector.fetchData();
                const success = data && data.result && data.result.records.length > 0;
                
                logMethodResult('data-conn-result', success,
                    success ? `Loaded ${data.result.records.length} records` : 'Data loading failed',
                    {
                        sourceType: connector.sourceType,
                        recordCount: data?.result?.records?.length
                    }
                );
            } catch (error) {
                logMethodResult('data-conn-result', false, `Error: ${error.message}`);
            }
        }

        function testAllDataSourceConnector() {
            testDataConnection();
        }

        // Initialize test sections
        function initializeTests() {
            // Authentication Tests
            createTestSection('Authentication', [
                {
                    name: 'hashPassword',
                    description: 'Tests password hashing functionality',
                    testFunction: 'testAuthHashPassword()',
                    resultId: 'auth-hash-result'
                },
                {
                    name: 'verifyCredentials',
                    description: 'Tests credential verification',
                    testFunction: 'testAuthVerifyCredentials()',
                    resultId: 'auth-verify-result'
                }
            ]);

            // UserAccount Tests
            createTestSection('UserAccount', [
                {
                    name: 'signup',
                    description: 'Tests user registration functionality',
                    testFunction: 'testUserSignup()',
                    resultId: 'user-signup-result'
                },
                {
                    name: 'login',
                    description: 'Tests user login functionality',
                    testFunction: 'testUserLogin()',
                    resultId: 'user-login-result'
                }
            ]);

            // TaxCalculator Tests
            createTestSection('TaxCalculator2025', [
                {
                    name: 'calculateIncomeTax',
                    description: 'Tests Singapore income tax calculation',
                    testFunction: 'testTaxCalculation()',
                    resultId: 'tax-calc-result'
                }
            ]);

            // DataSourceConnector Tests
            createTestSection('DataSourceConnector', [
                {
                    name: 'fetchData',
                    description: 'Tests CORS-safe data fetching',
                    testFunction: 'testDataConnection()',
                    resultId: 'data-conn-result'
                }
            ]);
        }

        // Initialize when page loads
        window.addEventListener('load', initializeTests);
    </script>
</body>
</html>